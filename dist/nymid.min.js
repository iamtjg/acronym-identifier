"use strict";const NYM_REGEX=/(?:\b)([A-Z]{2,})(?:\b)/g;function nymid(options){if(!options.definitionlist){options.definitionlist=undefined}let nymNodes=findNymNodes(options.startingElement);let uniqueNyms=uniquePageNyms(nymNodes);if(options.definitionProvider){fetch(options.definitionProvider,{method:"POST",body:JSON.stringify({nyms:uniqueNyms})}).then(function(response){return response.json()}).then(function(json){insertWidget(json,options.widgetPosition)}).catch(function(error){insertWidget({ERROR:"Unable to reach definition provider"},options.widgetPosition)})}else if(options.definitionList){let definedAcronyms=defineAcronyms(uniqueNyms,options.definitionList);insertWidget(definedAcronyms,options.widgetPosition)}else{insertWidget({ERROR:"No definition provider or definition list"},options.widgetPosition)}}function findNymNodes(element){if(!element){element=document.body}let nodes=element.querySelectorAll("*");let nymNodes=[];for(let i=0;i<nodes.length;i++){let nyms=nodes[i].textContent.match(NYM_REGEX);if(nyms){let finNyms=nyms.filter(isUniqueInArray);nodes[i].setAttribute("data-nyms",finNyms);nodes[i].setAttribute("data-nym-node-id",i);nymNodes.push({"nym-node-id":i,nyms:finNyms})}}return nymNodes}function uniquePageNyms(nymNodes){let uniqueNyms=[];nymNodes.map(function(node){node.nyms.map(function(nym){if(uniqueNyms.indexOf(nym)==-1){uniqueNyms.push(nym)}})});return uniqueNyms}function defineAcronyms(uniqueNyms,definitionList){let defined={};uniqueNyms.map(function(nym){if(definitionList[nym]){defined[nym]=definitionList[nym]}else{defined[nym]="No definition found"}});return defined}function insertWidget(definedAcronyms,position){if(!position){position="right"}let nymContainer=document.createElement("aside");nymContainer.classList.add("nym-container");nymContainer.innerHTML="&#x1F4A1;";nymContainer.classList.add(`nym-container-pos-${position}`);nymContainer.addEventListener("click",function(){this.classList.toggle("nymlist-active")});let nymList=document.createElement("dl");nymList.classList.add("nymlist");for(let nym in definedAcronyms){let nymTerm=document.createElement("dt");nymTerm.textContent=`${nym}`;if(Array.isArray(definedAcronyms[nym])){let defArr=definedAcronyms[nym];defArr.map(function(def){let nymDef=document.createElement("dd");nymDef.textContent=`${def}`;nymTerm.appendChild(nymDef)})}else{let nymDef=document.createElement("dd");nymDef.textContent=`${definedAcronyms[nym]}`;nymTerm.appendChild(nymDef)}nymList.appendChild(nymTerm)}nymContainer.appendChild(nymList);document.querySelector("body").appendChild(nymContainer)}function isUniqueInArray(element,index,array){return array.indexOf(element)===index}